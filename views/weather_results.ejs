<%- include("partials/header") %>


<div class="relative">
    <br><br><br><br><br>
  <!-- Background Video -->
  <video autoplay muted loop playsinline class="absolute inset-0 w-full h-full object-cover opacity-30 z-0">
    <source src="/videos/5040711-hd_1920_1080_30fps.mp4" type="video/mp4" />
    Your browser does not support the video tag.
  </video>

  <!-- Weather Content -->
  <div class="relative z-10 max-w-5xl mx-auto mt-10 p-6 bg-slate-800/80 backdrop-blur-md rounded-2xl shadow-2xl text-white space-y-8">
    <% if (error){ %>
  <p class="text-red-500 text-center mt-4 text-lg font-medium"><%= error %></p>
<% } else { %>

  <div class="max-w-4xl mx-auto mt-10 p-6 bg-slate-800 rounded-2xl shadow-lg text-white space-y-6">
    <!-- Header with Flag -->
    <div class="text-center">
      <h2 class="text-2xl font-bold mb-2">
        Weather in <%= city %>, <%= country %>
      </h2>
      <img src="https://flagcdn.com/w40/<%= country.toLowerCase() %>.png" alt="<%= country %> flag" class="inline-block" />
    </div>

    <!-- Weather Card -->
    <div class="bg-slate-700 rounded-xl shadow-md p-6 flex flex-col md:flex-row items-center justify-between">
      <div>
        <p class="text-xl font-semibold">ğŸŒ¡ Temperature: <%= temperature %>Â°C</p>
        <p class="text-lg capitalize mt-1">ğŸ” <%= description %></p>
        <p class="mt-2">ğŸ§­ Coordinates:</p>
        <p>â†•ï¸ Latitude: <%= lat %>Â°</p>
        <p>â†”ï¸ Longitude: <%= lon %>Â°</p>
        <!-- Friendly Weather Summary -->
<%
  function getFriendlyWeather(desc, temp) {
    const d = desc.toLowerCase();
    if (d.includes("clear")) return `â˜€ï¸ It's a sunny day at ${temp}Â°C â€” great time to be outdoors!`;
    if (d.includes("cloud")) return `â˜ï¸ The skies are cloudy at ${temp}Â°C â€” calm and mild.`;
    if (d.includes("rain")) return `ğŸŒ§ï¸ It's raining at ${temp}Â°C â€” grab your umbrella.`;
    if (d.includes("snow")) return `â„ï¸ Snowfall at ${temp}Â°C â€” time for a warm drink!`;
    if (d.includes("thunder")) return `â›ˆï¸ Thunderstorms are happening at ${temp}Â°C â€” stay safe indoors.`;
    if (d.includes("mist") || d.includes("fog")) return `ğŸŒ«ï¸ Visibility is low at ${temp}Â°C due to mist or fog.`;
    return `ğŸŒ¤ï¸ Current conditions: ${desc} with a temperature of ${temp}Â°C.`;
  }
%>

<div class="bg-slate-700 rounded-xl shadow-md p-4 text-center text-lg font-medium italic">
  <%= getFriendlyWeather(description, temperature) %>
</div>

      </div>

      <!-- Icon Display -->
      <div class="mt-4 md:mt-0">
        <% 
          let icon = "â˜ï¸"; // Default
          const desc = description.toLowerCase();
          if (desc.includes("clear")) icon = "â˜€ï¸";
          else if (desc.includes("cloud")) icon = "â˜ï¸";
          else if (desc.includes("rain")) icon = "ğŸŒ§ï¸";
          else if (desc.includes("snow")) icon = "â„ï¸";
          else if (desc.includes("thunder")) icon = "â›ˆï¸";
          else if (desc.includes("mist") || desc.includes("fog")) icon = "ğŸŒ«ï¸";
        %>
        <div class="text-6xl"><%= icon %></div>
      </div>
    </div>

    <!-- Map Section -->
    <div class="mt-6">
      <div id="map" class="h-96 w-full rounded-lg border-2 border-blue-500"></div>
    </div>

    <!-- Other Weather Info -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-6 text-base md:text-lg">
      <div class="bg-slate-700 p-4 rounded-lg shadow">
        <p>ğŸ“– <strong>Description:</strong> <%= description %></p>
        <p>ğŸ’¨ <strong>Wind Speed:</strong> <%= windspeed %> m/s</p>
        <p>ğŸ’§ <strong>Humidity:</strong> <%= humidity %>%</p>
      </div>
      <div class="bg-slate-700 p-4 rounded-lg shadow">
        <p>ğŸ§­ <strong>Pressure:</strong> <%= pressure %> hPa</p>
        <p>ğŸŒ… <strong>Sunrise:</strong> <%= sunrise %> (UTC)</p>
        <p>ğŸŒ‡ <strong>Sunset:</strong> <%= sunset %> (UTC)</p>
      </div>
      <div class="bg-slate-700 p-4 rounded-lg shadow md:col-span-2">
        <p>ğŸï¸ <strong>Ground Level:</strong> <%= groundlevel %> hPa</p>
        <p>ğŸŒŠ <strong>Sea Level:</strong> <%= sealevel %> hPa</p>
      </div>
    </div>
  </div>

  <!-- Map Script -->
  <script>
    const lat = <%- JSON.stringify(lat) %>;
    const lon = <%- JSON.stringify(lon) %>;
    console.log("JS lat:", lat);
    console.log("JS lon:", lon);

    const map = L.map('map').setView([lat, lon], 10);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    L.marker([lat, lon]).addTo(map)
      .bindPopup("<b><%= city %></b><br><%= country %>").openPopup();
  </script>

<% } %>

      </div> <!-- Weather content -->
      <br><br><br><br><br><br>
</div>   <!-- Video wrapper -->





<%- include("partials/footer") %>
